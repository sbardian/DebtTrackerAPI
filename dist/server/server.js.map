{"version":3,"sources":["../../src/server/server.js"],"names":["express","require","bodyParser","session","mongoose","bluebird","cors","MongoStore","routesLogic","server","init","expressServer","corsOptions","credentials","origin","use","connect","useMongoClient","promiseLibrary","db","connection","on","console","error","bind","once","secret","resave","saveUninitialized","store","mongooseConnection","autoRemove","autoRemoveInterval","urlencoded","extended","json","checkAuth","expressStatic","static","disableDotRule","verbose","module","exports"],"mappings":";;AAGA;;;;AACA;;;;AAGA;;;;;;AANA,MAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,MAAMC,aAAaD,QAAQ,aAAR,CAAnB;;AAGA,MAAME,UAAUF,QAAQ,iBAAR,CAAhB;AACA,MAAMG,WAAWH,QAAQ,UAAR,CAAjB;;AAEA,MAAMI,WAAWJ,QAAQ,UAAR,CAAjB;AACA,MAAMK,OAAOL,QAAQ,MAAR,CAAb;AACA,MAAMM,aAAaN,QAAQ,eAAR,EAAyBE,OAAzB,CAAnB;AACA,MAAMK,cAAcP,QAAQ,eAAR,CAApB;;AAEA,MAAMQ,SAAS;AACb;;;;;AAKAC,SAAO;AACL,UAAMC,gBAAgBX,SAAtB;;AAEA,UAAMY,cAAc;AAClBC,mBAAa,IADK;AAElBC,cAAQ;AAFU,KAApB;;AAKAH,kBAAcI,GAAd,CAAkBT,KAAKM,WAAL,CAAlB;;AAEAR,aAASY,OAAT,CACI,iCADJ,EAEI,EAAEC,gBAAgB,IAAlB;AACEC,sBAAgBb;AADlB,KAFJ;;AAMA,UAAMc,KAAKf,SAASgB,UAApB;;AAEA;AACAD,OAAGE,EAAH,CAAM,OAAN,EAAeC,QAAQC,KAAR,CAAcC,IAAd,CAAmBF,OAAnB,EAA4B,mBAA5B,CAAf;AACAH,OAAGM,IAAH,CAAQ,MAAR,EAAgB,YAAY;AAC1B;AACD,KAFD;;AAIA;AACA;AACAd,kBAAcI,GAAd,CAAkBZ,QAAQ;AACxBuB,cAAQ,oBADgB;AAExBC,cAAQ,KAFgB;AAGxBC,yBAAmB,IAHK;AAIxBC,aAAO,IAAItB,UAAJ,CAAe;AACpBuB,4BAAoBX,EADA;AAEpBY,oBAAY,UAFQ;AAGpBC,4BAAoB;AAHA,OAAf;AAJiB,KAAR,CAAlB;;AAWA;AACA;AACArB,kBAAcI,GAAd,CAAkBb,WAAW+B,UAAX,CAAsB,EAACC,UAAU,IAAX,EAAtB,CAAlB;AACAvB,kBAAcI,GAAd,CAAkBb,WAAWiC,IAAX,EAAlB;;AAEA;AACAxB,kBAAcI,GAAd,CAAkB,OAAlB;;AAEA;AACA;AACAJ,kBAAcI,GAAd,CAAkB,MAAlB,EAA0BP,YAAY4B,SAAtC;;AAEA;AACA,UAAMC,gBAAgBrC,QAAQsC,MAAR,CAAe,aAAf,CAAtB;AACA3B,kBAAcI,GAAd,CAAkBsB,aAAlB;AACA1B,kBAAcI,GAAd,CAAkB,yCAAmB;AACnCwB,sBAAgB,IADmB;AAEnCC,eAAS;AAF0B,KAAnB,CAAlB;AAIA7B,kBAAcI,GAAd,CAAkBsB,aAAlB;;AAEA,WAAO1B,aAAP;AACD;AAjEY,CAAf;;AAoEA8B,OAAOC,OAAP,GAAiBjC,MAAjB","file":"server.js","sourcesContent":["\nconst express = require('express');\nconst bodyParser = require('body-parser');\nimport apiRoutes from './apiRoutes';\nimport authRoutes from './authRoutes';\nconst session = require('express-session');\nconst mongoose = require('mongoose');\nimport historyApiFallback from 'connect-history-api-fallback';\nconst bluebird = require('bluebird');\nconst cors = require('cors');\nconst MongoStore = require('connect-mongo')(session);\nconst routesLogic = require('./routesLogic');\n\nconst server = {\n  /**\n   * Initialize server, and routes.\n   *\n   * @returns {express} expressServer - The express server instance.\n   */\n  init() {\n    const expressServer = express();\n\n    const corsOptions = {\n      credentials: true,\n      origin: true,\n    };\n\n    expressServer.use(cors(corsOptions));\n\n    mongoose.connect(\n        'mongodb://localhost/DeptTracker',\n        { useMongoClient: true,\n          promiseLibrary: bluebird,\n        });\n\n    const db = mongoose.connection;\n\n    //handle mongo error\n    db.on('error', console.error.bind(console, 'connection error:'));\n    db.once('open', function () {\n      // we're connected!\n    });\n\n    // use sessions for tracking logins\n    // TODO: use env var for secret, using npm script\n    expressServer.use(session({\n      secret: 'shit sandwich dawg',\n      resave: false,\n      saveUninitialized: true,\n      store: new MongoStore({\n        mongooseConnection: db,\n        autoRemove: 'interval',\n        autoRemoveInterval: 10,\n      })\n    }));\n\n    // configure server to use bodyParser()\n    // this will let us get the data from a POST\n    expressServer.use(bodyParser.urlencoded({extended: true}));\n    expressServer.use(bodyParser.json());\n\n    // routes to login/register/logout\n    expressServer.use('/auth', authRoutes);\n\n    // REGISTER OUR API ROUTES\n    // all of our routes will be prefixed with /api\n    expressServer.use('/api', routesLogic.checkAuth, apiRoutes);\n\n    // middleware to use for all requests\n    const expressStatic = express.static('dist/client');\n    expressServer.use(expressStatic);\n    expressServer.use(historyApiFallback({\n      disableDotRule: true,\n      verbose: true,\n    }));\n    expressServer.use(expressStatic);\n\n    return expressServer;\n  }\n};\n\nmodule.exports = server;\n"]}
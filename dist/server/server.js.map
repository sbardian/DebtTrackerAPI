{"version":3,"sources":["../../src/server/server.js"],"names":["express","require","bodyParser","routes","session","mongoose","bluebird","cors","MongoStore","server","init","expressServer","corsOptions","credentials","origin","use","connect","useMongoClient","promiseLibrary","db","connection","on","console","error","bind","once","secret","resave","saveUninitialized","store","mongooseConnection","autoRemove","autoRemoveInterval","urlencoded","extended","json","router","Router","setRoutes","static","module","exports"],"mappings":";;AACA,MAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,MAAMC,aAAaD,QAAQ,aAAR,CAAnB;AACA,MAAME,SAASF,QAAQ,UAAR,CAAf;AACA,MAAMG,UAAUH,QAAQ,iBAAR,CAAhB;AACA,MAAMI,WAAWJ,QAAQ,UAAR,CAAjB;AACA,MAAMK,WAAWL,QAAQ,UAAR,CAAjB;AACA,MAAMM,OAAON,QAAQ,MAAR,CAAb;AACA,MAAMO,aAAaP,QAAQ,eAAR,EAAyBG,OAAzB,CAAnB;;AAEA,MAAMK,SAAS;AACb;;;;;AAKAC,SAAO;AACL,UAAMC,gBAAgBX,SAAtB;;AAEA,UAAMY,cAAc;AAClBC,mBAAa,IADK;AAElBC,cAAQ;AAFU,KAApB;;AAKAH,kBAAcI,GAAd,CAAkBR,KAAKK,WAAL,CAAlB;;AAEAP,aAASW,OAAT,CACI,iCADJ,EAEI,EAAEC,gBAAgB,IAAlB;AACEC,sBAAgBZ;AADlB,KAFJ;;AAMA,UAAMa,KAAKd,SAASe,UAApB;;AAEA;AACAD,OAAGE,EAAH,CAAM,OAAN,EAAeC,QAAQC,KAAR,CAAcC,IAAd,CAAmBF,OAAnB,EAA4B,mBAA5B,CAAf;AACAH,OAAGM,IAAH,CAAQ,MAAR,EAAgB,YAAY;AAC1B;AACD,KAFD;;AAIA;AACA;AACAd,kBAAcI,GAAd,CAAkBX,QAAQ;AACxBsB,cAAQ,oBADgB;AAExBC,cAAQ,KAFgB;AAGxBC,yBAAmB,IAHK;AAIxBC,aAAO,IAAIrB,UAAJ,CAAe;AACpBsB,4BAAoBX,EADA;AAEpBY,oBAAY,UAFQ;AAGpBC,4BAAoB;AAHA,OAAf;AAJiB,KAAR,CAAlB;;AAWA;AACA;AACArB,kBAAcI,GAAd,CAAkBb,WAAW+B,UAAX,CAAsB,EAACC,UAAU,IAAX,EAAtB,CAAlB;AACAvB,kBAAcI,GAAd,CAAkBb,WAAWiC,IAAX,EAAlB;;AAEA,UAAMC,SAASpC,QAAQqC,MAAR,EAAf;;AAEA;AACAlC,WAAOmC,SAAP,CAAiBF,MAAjB;;AAEA;AACA;AACAzB,kBAAcI,GAAd,CAAkB,MAAlB,EAA0BqB,MAA1B;;AAEA;AACAzB,kBAAcI,GAAd,CAAkBf,QAAQuC,MAAR,CAAe,aAAf,CAAlB;;AAEA,WAAO5B,aAAP;AACD;AA7DY,CAAf;;AAgEA6B,OAAOC,OAAP,GAAiBhC,MAAjB","file":"server.js","sourcesContent":["\nconst express = require('express');\nconst bodyParser = require('body-parser');\nconst routes = require('./routes');\nconst session = require('express-session');\nconst mongoose = require('mongoose');\nconst bluebird = require('bluebird');\nconst cors = require('cors');\nconst MongoStore = require('connect-mongo')(session);\n\nconst server = {\n  /**\n   * Initialize server, and routes.\n   *\n   * @returns {express} expressServer - The express server instance.\n   */\n  init() {\n    const expressServer = express();\n\n    const corsOptions = {\n      credentials: true,\n      origin: true,\n    };\n\n    expressServer.use(cors(corsOptions));\n\n    mongoose.connect(\n        'mongodb://localhost/DeptTracker',\n        { useMongoClient: true,\n          promiseLibrary: bluebird,\n        });\n\n    const db = mongoose.connection;\n\n    //handle mongo error\n    db.on('error', console.error.bind(console, 'connection error:'));\n    db.once('open', function () {\n      // we're connected!\n    });\n\n    // use sessions for tracking logins\n    // TODO: use env var for secret, using npm script\n    expressServer.use(session({\n      secret: 'shit sandwich dawg',\n      resave: false,\n      saveUninitialized: true,\n      store: new MongoStore({\n        mongooseConnection: db,\n        autoRemove: 'interval',\n        autoRemoveInterval: 10,\n      })\n    }));\n\n    // configure server to use bodyParser()\n    // this will let us get the data from a POST\n    expressServer.use(bodyParser.urlencoded({extended: true}));\n    expressServer.use(bodyParser.json());\n\n    const router = express.Router();\n\n    // include our routes\n    routes.setRoutes(router);\n\n    // REGISTER OUR ROUTES\n    // all of our routes will be prefixed with /api\n    expressServer.use('/api', router);\n\n    // middleware to use for all requests\n    expressServer.use(express.static('dist/client'));\n\n    return expressServer;\n  }\n};\n\nmodule.exports = server;\n"]}